#!/usr/bin/env python3
"""
Run: Run entire pipeline
"""

# Initialize

# from blang_mysql import *
from blang import Run

# Start

# Get evorates for Catalytic Site Atlas (M-CSA) residues:

# Multi-line version:
# echo "CAPRA0"
# EVO="capra0_einsi"; echo -ne "$EVO\t"; ~/scripts/query.pl "SELECT COUNT(DISTINCT c.acc, c.site), AVG(r.rate) FROM m_csa c, uniens ue, evorate_$EVO r WHERE c.species='HUMAN' AND c.acc=ue.acc AND ue.ensp=r.ensp AND c.site=r.site"
# EVO="capra0_ginsi"; echo -ne "$EVO\t"; ~/scripts/query.pl "SELECT COUNT(DISTINCT c.acc, c.site), AVG(r.rate) FROM m_csa c, uniens ue, evorate_$EVO r WHERE c.species='HUMAN' AND c.acc=ue.acc AND ue.ensp=r.ensp AND c.site=r.site"
# EVO="capra0_linsi"; echo -ne "$EVO\t"; ~/scripts/query.pl "SELECT COUNT(DISTINCT c.acc, c.site), AVG(r.rate) FROM m_csa c, uniens ue, evorate_$EVO r WHERE c.species='HUMAN' AND c.acc=ue.acc AND ue.ensp=r.ensp AND c.site=r.site"
# EVO="capra0_einsi_tree"; echo -ne "$EVO\t"; ~/scripts/query.pl "SELECT COUNT(DISTINCT c.acc, c.site), AVG(r.rate) FROM m_csa c, uniens ue, evorate_$EVO r WHERE c.species='HUMAN' AND c.acc=ue.acc AND ue.ensp=r.ensp AND c.site=r.site"
# EVO="capra0_ginsi_tree"; echo -ne "$EVO\t"; ~/scripts/query.pl "SELECT COUNT(DISTINCT c.acc, c.site), AVG(r.rate) FROM m_csa c, uniens ue, evorate_$EVO r WHERE c.species='HUMAN' AND c.acc=ue.acc AND ue.ensp=r.ensp AND c.site=r.site"
# EVO="capra0_linsi_tree"; echo -ne "$EVO\t"; ~/scripts/query.pl "SELECT COUNT(DISTINCT c.acc, c.site), AVG(r.rate) FROM m_csa c, uniens ue, evorate_$EVO r WHERE c.species='HUMAN' AND c.acc=ue.acc AND ue.ensp=r.ensp AND c.site=r.site"
# EVO="capra0_einsi_tree_1para"; echo -ne "$EVO\t"; ~/scripts/query.pl "SELECT COUNT(DISTINCT c.acc, c.site), AVG(r.rate) FROM m_csa c, uniens ue, evorate_$EVO r WHERE c.species='HUMAN' AND c.acc=ue.acc AND ue.ensp=r.ensp AND c.site=r.site"
# echo "LICHTARGE"
# EVO="lichtarge_einsi"; echo -ne "$EVO\t"; ~/scripts/query.pl "SELECT COUNT(DISTINCT c.acc, c.site), AVG(r.rate) FROM m_csa c, uniens ue, evorate_$EVO r WHERE c.species='HUMAN' AND c.acc=ue.acc AND ue.ensp=r.ensp AND c.site=r.site"
# EVO="lichtarge_ginsi"; echo -ne "$EVO\t"; ~/scripts/query.pl "SELECT COUNT(DISTINCT c.acc, c.site), AVG(r.rate) FROM m_csa c, uniens ue, evorate_$EVO r WHERE c.species='HUMAN' AND c.acc=ue.acc AND ue.ensp=r.ensp AND c.site=r.site"
# EVO="lichtarge_linsi"; echo -ne "$EVO\t"; ~/scripts/query.pl "SELECT COUNT(DISTINCT c.acc, c.site), AVG(r.rate) FROM m_csa c, uniens ue, evorate_$EVO r WHERE c.species='HUMAN' AND c.acc=ue.acc AND ue.ensp=r.ensp AND c.site=r.site"
# EVO="lichtarge_einsi_tree"; echo -ne "$EVO\t"; ~/scripts/query.pl "SELECT COUNT(DISTINCT c.acc, c.site), AVG(r.rate) FROM m_csa c, uniens ue, evorate_$EVO r WHERE c.species='HUMAN' AND c.acc=ue.acc AND ue.ensp=r.ensp AND c.site=r.site"
# EVO="lichtarge_ginsi_tree"; echo -ne "$EVO\t"; ~/scripts/query.pl "SELECT COUNT(DISTINCT c.acc, c.site), AVG(r.rate) FROM m_csa c, uniens ue, evorate_$EVO r WHERE c.species='HUMAN' AND c.acc=ue.acc AND ue.ensp=r.ensp AND c.site=r.site"
# EVO="lichtarge_linsi_tree"; echo -ne "$EVO\t"; ~/scripts/query.pl "SELECT COUNT(DISTINCT c.acc, c.site), AVG(r.rate) FROM m_csa c, uniens ue, evorate_$EVO r WHERE c.species='HUMAN' AND c.acc=ue.acc AND ue.ensp=r.ensp AND c.site=r.site"
# EVO="lichtarge_einsi_tree_1para"; echo -ne "$EVO\t"; ~/scripts/query.pl "SELECT COUNT(DISTINCT c.acc, c.site), AVG(r.rate) FROM m_csa c, uniens ue, evorate_$EVO r WHERE c.species='HUMAN' AND c.acc=ue.acc AND ue.ensp=r.ensp AND c.site=r.site"
# echo "RATE4SITE"
# EVO="rate4site_einsi"; echo -ne "$EVO\t"; ~/scripts/query.pl "SELECT COUNT(DISTINCT c.acc, c.site), AVG(r.rate) FROM m_csa c, uniens ue, evorate_$EVO r WHERE c.species='HUMAN' AND c.acc=ue.acc AND ue.ensp=r.ensp AND c.site=r.site"
# EVO="rate4site_ginsi"; echo -ne "$EVO\t"; ~/scripts/query.pl "SELECT COUNT(DISTINCT c.acc, c.site), AVG(r.rate) FROM m_csa c, uniens ue, evorate_$EVO r WHERE c.species='HUMAN' AND c.acc=ue.acc AND ue.ensp=r.ensp AND c.site=r.site"
# EVO="rate4site_linsi"; echo -ne "$EVO\t"; ~/scripts/query.pl "SELECT COUNT(DISTINCT c.acc, c.site), AVG(r.rate) FROM m_csa c, uniens ue, evorate_$EVO r WHERE c.species='HUMAN' AND c.acc=ue.acc AND ue.ensp=r.ensp AND c.site=r.site"
# EVO="rate4site_einsi_tree"; echo -ne "$EVO\t"; ~/scripts/query.pl "SELECT COUNT(DISTINCT c.acc, c.site), AVG(r.rate) FROM m_csa c, uniens ue, evorate_$EVO r WHERE c.species='HUMAN' AND c.acc=ue.acc AND ue.ensp=r.ensp AND c.site=r.site"
# EVO="rate4site_ginsi_tree"; echo -ne "$EVO\t"; ~/scripts/query.pl "SELECT COUNT(DISTINCT c.acc, c.site), AVG(r.rate) FROM m_csa c, uniens ue, evorate_$EVO r WHERE c.species='HUMAN' AND c.acc=ue.acc AND ue.ensp=r.ensp AND c.site=r.site"
# EVO="rate4site_linsi_tree"; echo -ne "$EVO\t"; ~/scripts/query.pl "SELECT COUNT(DISTINCT c.acc, c.site), AVG(r.rate) FROM m_csa c, uniens ue, evorate_$EVO r WHERE c.species='HUMAN' AND c.acc=ue.acc AND ue.ensp=r.ensp AND c.site=r.site"
# EVO="rate4site_einsi_tree_1para"; echo -ne "$EVO\t"; ~/scripts/query.pl "SELECT COUNT(DISTINCT c.acc, c.site), AVG(r.rate) FROM m_csa c, uniens ue, evorate_$EVO r WHERE c.species='HUMAN' AND c.acc=ue.acc AND ue.ensp=r.ensp AND c.site=r.site"

# Single-line version:
Run("Get average evorates for M-CSA catalytic residues", """(echo "CAPRA0"; EVO="capra0_einsi"; echo -ne "$EVO\t"; ~/scripts/query.pl "SELECT COUNT(DISTINCT c.acc, c.site), AVG(r.rate) FROM m_csa c, uniens ue, evorate_$EVO r WHERE c.species='HUMAN' AND c.acc=ue.acc AND ue.ensp=r.ensp AND c.site=r.site"; EVO="capra0_ginsi"; echo -ne "$EVO\t"; ~/scripts/query.pl "SELECT COUNT(DISTINCT c.acc, c.site), AVG(r.rate) FROM m_csa c, uniens ue, evorate_$EVO r WHERE c.species='HUMAN' AND c.acc=ue.acc AND ue.ensp=r.ensp AND c.site=r.site"; EVO="capra0_linsi"; echo -ne "$EVO\t"; ~/scripts/query.pl "SELECT COUNT(DISTINCT c.acc, c.site), AVG(r.rate) FROM m_csa c, uniens ue, evorate_$EVO r WHERE c.species='HUMAN' AND c.acc=ue.acc AND ue.ensp=r.ensp AND c.site=r.site"; EVO="capra0_einsi_tree"; echo -ne "$EVO\t"; ~/scripts/query.pl "SELECT COUNT(DISTINCT c.acc, c.site), AVG(r.rate) FROM m_csa c, uniens ue, evorate_$EVO r WHERE c.species='HUMAN' AND c.acc=ue.acc AND ue.ensp=r.ensp AND c.site=r.site"; EVO="capra0_ginsi_tree"; echo -ne "$EVO\t"; ~/scripts/query.pl "SELECT COUNT(DISTINCT c.acc, c.site), AVG(r.rate) FROM m_csa c, uniens ue, evorate_$EVO r WHERE c.species='HUMAN' AND c.acc=ue.acc AND ue.ensp=r.ensp AND c.site=r.site"; EVO="capra0_linsi_tree"; echo -ne "$EVO\t"; ~/scripts/query.pl "SELECT COUNT(DISTINCT c.acc, c.site), AVG(r.rate) FROM m_csa c, uniens ue, evorate_$EVO r WHERE c.species='HUMAN' AND c.acc=ue.acc AND ue.ensp=r.ensp AND c.site=r.site"; EVO="capra0_einsi_tree_1para"; echo -ne "$EVO\t"; ~/scripts/query.pl "SELECT COUNT(DISTINCT c.acc, c.site), AVG(r.rate) FROM m_csa c, uniens ue, evorate_$EVO r WHERE c.species='HUMAN' AND c.acc=ue.acc AND ue.ensp=r.ensp AND c.site=r.site"; echo "LICHTARGE"; EVO="lichtarge_einsi"; echo -ne "$EVO\t"; ~/scripts/query.pl "SELECT COUNT(DISTINCT c.acc, c.site), AVG(r.rate) FROM m_csa c, uniens ue, evorate_$EVO r WHERE c.species='HUMAN' AND c.acc=ue.acc AND ue.ensp=r.ensp AND c.site=r.site"; EVO="lichtarge_ginsi"; echo -ne "$EVO\t"; ~/scripts/query.pl "SELECT COUNT(DISTINCT c.acc, c.site), AVG(r.rate) FROM m_csa c, uniens ue, evorate_$EVO r WHERE c.species='HUMAN' AND c.acc=ue.acc AND ue.ensp=r.ensp AND c.site=r.site"; EVO="lichtarge_linsi"; echo -ne "$EVO\t"; ~/scripts/query.pl "SELECT COUNT(DISTINCT c.acc, c.site), AVG(r.rate) FROM m_csa c, uniens ue, evorate_$EVO r WHERE c.species='HUMAN' AND c.acc=ue.acc AND ue.ensp=r.ensp AND c.site=r.site"; EVO="lichtarge_einsi_tree"; echo -ne "$EVO\t"; ~/scripts/query.pl "SELECT COUNT(DISTINCT c.acc, c.site), AVG(r.rate) FROM m_csa c, uniens ue, evorate_$EVO r WHERE c.species='HUMAN' AND c.acc=ue.acc AND ue.ensp=r.ensp AND c.site=r.site"; EVO="lichtarge_ginsi_tree"; echo -ne "$EVO\t"; ~/scripts/query.pl "SELECT COUNT(DISTINCT c.acc, c.site), AVG(r.rate) FROM m_csa c, uniens ue, evorate_$EVO r WHERE c.species='HUMAN' AND c.acc=ue.acc AND ue.ensp=r.ensp AND c.site=r.site"; EVO="lichtarge_linsi_tree"; echo -ne "$EVO\t"; ~/scripts/query.pl "SELECT COUNT(DISTINCT c.acc, c.site), AVG(r.rate) FROM m_csa c, uniens ue, evorate_$EVO r WHERE c.species='HUMAN' AND c.acc=ue.acc AND ue.ensp=r.ensp AND c.site=r.site"; EVO="lichtarge_einsi_tree_1para"; echo -ne "$EVO\t"; ~/scripts/query.pl "SELECT COUNT(DISTINCT c.acc, c.site), AVG(r.rate) FROM m_csa c, uniens ue, evorate_$EVO r WHERE c.species='HUMAN' AND c.acc=ue.acc AND ue.ensp=r.ensp AND c.site=r.site"; echo "RATE4SITE"; EVO="rate4site_einsi"; echo -ne "$EVO\t"; ~/scripts/query.pl "SELECT COUNT(DISTINCT c.acc, c.site), AVG(r.rate) FROM m_csa c, uniens ue, evorate_$EVO r WHERE c.species='HUMAN' AND c.acc=ue.acc AND ue.ensp=r.ensp AND c.site=r.site"; EVO="rate4site_ginsi"; echo -ne "$EVO\t"; ~/scripts/query.pl "SELECT COUNT(DISTINCT c.acc, c.site), AVG(r.rate) FROM m_csa c, uniens ue, evorate_$EVO r WHERE c.species='HUMAN' AND c.acc=ue.acc AND ue.ensp=r.ensp AND c.site=r.site"; EVO="rate4site_linsi"; echo -ne "$EVO\t"; ~/scripts/query.pl "SELECT COUNT(DISTINCT c.acc, c.site), AVG(r.rate) FROM m_csa c, uniens ue, evorate_$EVO r WHERE c.species='HUMAN' AND c.acc=ue.acc AND ue.ensp=r.ensp AND c.site=r.site"; EVO="rate4site_einsi_tree"; echo -ne "$EVO\t"; ~/scripts/query.pl "SELECT COUNT(DISTINCT c.acc, c.site), AVG(r.rate) FROM m_csa c, uniens ue, evorate_$EVO r WHERE c.species='HUMAN' AND c.acc=ue.acc AND ue.ensp=r.ensp AND c.site=r.site"; EVO="rate4site_ginsi_tree"; echo -ne "$EVO\t"; ~/scripts/query.pl "SELECT COUNT(DISTINCT c.acc, c.site), AVG(r.rate) FROM m_csa c, uniens ue, evorate_$EVO r WHERE c.species='HUMAN' AND c.acc=ue.acc AND ue.ensp=r.ensp AND c.site=r.site"; EVO="rate4site_linsi_tree"; echo -ne "$EVO\t"; ~/scripts/query.pl "SELECT COUNT(DISTINCT c.acc, c.site), AVG(r.rate) FROM m_csa c, uniens ue, evorate_$EVO r WHERE c.species='HUMAN' AND c.acc=ue.acc AND ue.ensp=r.ensp AND c.site=r.site"; EVO="rate4site_einsi_tree_1para"; echo -ne "$EVO\t"; ~/scripts/query.pl "SELECT COUNT(DISTINCT c.acc, c.site), AVG(r.rate) FROM m_csa c, uniens ue, evorate_$EVO r WHERE c.species='HUMAN' AND c.acc=ue.acc AND ue.ensp=r.ensp AND c.site=r.site") > output-rough-avg-evorate-without-controls.tsv""")
Run("Show table", "cat output-rough-avg-evorate-without-controls.tsv")

# Leaving out membrane:
Run("Compare M-CSA catalytic residues against structured control residues", "main.py -no_membrane_controls")

print("Done!")
